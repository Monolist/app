language: node_js

node_js:
  - 0.12.0

before_install:
  - source ~/.nvm/nvm.sh && nvm install $SHIPPABLE_NODE_VERSION
  - npm install -g gulp-cli
  - SUDO=$(which sudo) && $SUDO pip install awsebcli

before_script:
  - mkdir -p ~/.aws
  - echo '[profile eb-cli]' > ~/.aws/config
  - echo "aws_access_key_id = $AWSAccessKeyId" >> ~/.aws/config
  - echo "aws_secret_access_key = $AWSSecretKey" >> ~/.aws/config
  - mkdir -p shippable/codecoverage

script:
  - gulp test
  - mkdir -p .elasticbeanstalk
  - cp config.yml .elasticbeanstalk/

after_success:
  - gulp prod
  - gulp switchAPI
  - gulp deploy
  - eb init && eb deploy --timeout 20

env:
  global:
    - AWSAccessKeyId=AKIAJ4NNVVB6HSCYFBIA
    - AWS_KEY=AKIAJ4NNVVB6HSCYFBIA
    - secure: OJQSAkX41UWDy6Ub4+dL8bdSaV9hJOfsvuEX4Rr2iGyVwISX5XXoP3e3Lbq/N9jYxdv/dfJWUdUlhmJxaw/phOP4Pd750rbsQ438H4UQ6XSowVB+qO0U4W01XxSs8F96CK3UeHiDT4zwSn+LY3oA7zJ+b52shs4KyrpnFdi7TmOeQ3BvciVNyYbYubaxI7lO2Y+2dOcRE3VQs+mm9n3vR5KbBAqGrvSPoWkh5b2WUsuSSDvc8DS1aEdIKrBRjDWEIVPR0SoX4KH/UEy5MqZdBAV29YceSxpX7IkPL5cSRcDz2R4rtV7sK4/5wzwLFxqJYXlVWdXp1kou/VADPhtn/A==